---
interface Props {
    phone: string;
    message?: string;
}

const { phone, message = "" } = Astro.props;

// Limpia el número a solo dígitos para wa.me
const digits = (phone || "").replace(/[^\d]/g, "");

// Construye la URL destino
const href = `https://wa.me/${digits}${message.trim() ? `?text=${encodeURIComponent(message)}` : ""}`;
---
<a
        href={href}
        target="_blank"
        rel="nofollow noopener noreferrer"
        aria-label="Abrir chat de WhatsApp"
        role="button"
        data-wb
        class="
    fixed right-4 bottom-4 md:right-6 md:bottom-6
    grid place-items-center
    rounded-full
    select-none
    z-[60]
    /* Tamaño: más grande en móvil, un poco más discreto en desktop */
    w-16 h-16 md:w-14 md:h-14
    /* Color corporativo WhatsApp */
    bg-[#25D366]
    /* Icono en blanco */
    text-white
    /* Sombra elegante */
    shadow-lg shadow-black/20
    /* Hover/active sutiles */
    transition-transform duration-200 ease-out
    hover:scale-105 hover:brightness-110 active:scale-95
    /* Animación de entrada (start invisible) */
    opacity-0 translate-y-3
    motion-reduce:transition-none motion-reduce:transform-none
  "
>
    <!-- SVG oficial (marca WhatsApp) en vector -->
    <svg
            class="w-7 h-7 md:w-6 md:h-6"
            viewBox="0 0 32 32"
            aria-hidden="true"
            focusable="false"
            xmlns="http://www.w3.org/2000/svg"
    >
        <path fill="currentColor" d="M19.11 17.28c-.27-.13-1.57-.77-1.81-.86c-.24-.09-.42-.13-.6.14c-.18.27-.69.86-.84 1.03c-.15.18-.31.2-.58.07c-.27-.13-1.14-.42-2.17-1.34c-.8-.71-1.34-1.59-1.5-1.86c-.15-.27-.02-.42.11-.55c.11-.11.24-.27.36-.4c.12-.13.16-.22.24-.37c.08-.16.04-.29-.02-.41c-.07-.13-.6-1.45-.82-1.99c-.22-.53-.44-.46-.6-.46c-.16 0-.34-.02-.52-.02s-.48.07-.73.34c-.25.27-.97.95-.97 2.32c0 1.37.99 2.7 1.13 2.89c.13.18 1.95 2.98 4.73 4.05c.66.25 1.18.39 1.58.5c.66.21 1.26.18 1.73.11c.53-.08 1.57-.64 1.79-1.26c.22-.62.22-1.15.15-1.26c-.07-.11-.25-.18-.52-.31m-3.12 6.58h-.01c-1.85 0-3.67-.5-5.25-1.45l-.38-.23l-3.9 1.02l1.04-3.8l-.25-.39a9.668 9.668 0 0 1-1.47-5.1c0-5.35 4.36-9.71 9.72-9.71c2.6 0 5.04 1.02 6.88 2.86a9.653 9.653 0 0 1 2.84 6.86c-.01 5.35-4.37 9.71-9.72 9.71M26.88 5.12A13.41 13.41 0 0 0 16 1C8.27 1 2 7.27 2 15c0 2.46.67 4.86 1.95 6.96L2 31l9.2-1.91A14.03 14.03 0 0 0 16 29c7.73 0 14-6.27 14-14c0-3.74-1.46-7.25-4.12-9.88z"/>
    </svg>
</a>

<!-- Animación de entrada: fade + slide desde la esquina (sin FOUC) -->
<script is:inline>
    (() => {
        // Respecta preferencia del usuario (reduce motion)
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        const nodes = document.querySelectorAll('[data-wb]');
        if (!nodes.length) return;

        // Usa rAF para esperar al primer paint y animar
        requestAnimationFrame(() => {
            nodes.forEach((el) => {
                if (prefersReduced) {
                    el.classList.remove('opacity-0', 'translate-y-3');
                    return;
                }
                // Transición suave
                el.classList.add('transition', 'duration-500', 'ease-out');
                el.classList.remove('opacity-0', 'translate-y-3');
                el.classList.add('opacity-100', 'translate-y-0');
            });
        });
    })();
</script>
